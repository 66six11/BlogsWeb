# 开发规范

## 1. 代码风格规范

### 1.1 基本规则

- **语言**: 使用 TypeScript 编写所有代码
- **缩进**: 使用 2 个空格进行缩进
- **换行**: 使用 Unix 风格的换行符 (`\n`)
- **行宽**: 每行代码长度不超过 120 个字符
- **文件编码**: 使用 UTF-8 编码
- **文件扩展名**: 
  - React 组件: `.tsx`
  - TypeScript 文件: `.ts`
  - 样式文件: `.css` 或 `.scss`
  - 配置文件: `.json` 或 `.js`

### 1.2 命名规范

#### 1.2.1 变量和函数

- 使用 `camelCase` 命名法
- 变量名应该清晰、描述性强
- 函数名应该以动词开头
- 避免使用缩写，除非是广泛使用的缩写（如 `API`、`URL`）

```typescript
// 好的命名
const userProfile = { /* ... */ };
const fetchUserData = async () => { /* ... */ };

// 不好的命名
const up = { /* ... */ };
const f = async () => { /* ... */ };
```

#### 1.2.2 类和组件

- 使用 `PascalCase` 命名法
- 类名应该清晰、描述性强
- React 组件名应该是名词

```typescript
// 好的命名
class UserService {
  // ...
}

const UserProfile: React.FC = () => { /* ... */ };

// 不好的命名
class userService {
  // ...
}

const user_profile: React.FC = () => { /* ... */ };
```

#### 1.2.3 常量

- 使用 `UPPER_CASE` 命名法
- 常量名应该清晰、描述性强
- 使用下划线分隔单词

```typescript
// 好的命名
const API_URL = 'https://api.example.com';
const MAX_RESULTS = 100;

// 不好的命名
const apiUrl = 'https://api.example.com';
const maxResults = 100;
```

#### 1.2.4 接口和类型

- 使用 `PascalCase` 命名法
- 接口名以 `I` 开头（可选，根据团队偏好）
- 类型名应该清晰、描述性强

```typescript
// 好的命名
interface User {
  id: string;
  name: string;
  email: string;
}

interface IUserProfileProps {
  user: User;
}

type Theme = 'light' | 'dark';

// 不好的命名
interface user {
  // ...
}

type t = 'light' | 'dark';
```

### 1.3 代码结构

#### 1.3.1 导入顺序

1. 外部库导入
2. 内部模块导入
3. 样式导入
4. 类型导入

```typescript
// 外部库导入
import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { create } from 'zustand';

// 内部模块导入
import { User } from '../types';
import { fetchUserData } from '../services/userService';
import { useAuthStore } from '../store/useAuthStore';

// 样式导入
import './UserProfile.css';

// 类型导入
import type { UserProfileProps } from '../types';
```

#### 1.3.2 函数结构

- 函数应该简洁、单一职责
- 函数长度不超过 50 行
- 避免嵌套函数，除非是闭包或钩子函数
- 使用箭头函数而非 `function` 关键字，除非是类方法

```typescript
// 好的函数结构
const fetchUserData = async (userId: string): Promise<User | null> => {
  try {
    const response = await fetch(`${API_URL}/users/${userId}`);
    if (!response.ok) throw new Error('Failed to fetch user data');
    return await response.json();
  } catch (error) {
    console.error('Error fetching user data:', error);
    return null;
  }
};

// 不好的函数结构
function fetchUserData(userId) {
  return fetch(`${API_URL}/users/${userId}`)
    .then(response => {
      if (!response.ok) {
        throw new Error('Failed to fetch user data');
      }
      return response.json();
    })
    .catch(error => {
      console.error('Error fetching user data:', error);
      return null;
    });
}
```

#### 1.3.3 React 组件结构

- 使用函数式组件和 Hooks
- 组件结构：
  1. 导入
  2. 类型定义
  3. 组件定义
  4. 状态和钩子
  5. 辅助函数
  6. 渲染逻辑

```typescript
import React, { useState, useEffect } from 'react';
import { User } from '../types';
import { fetchUserData } from '../services/userService';

interface UserProfileProps {
  userId: string;
}

const UserProfile: React.FC<UserProfileProps> = ({ userId }) => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const loadUser = async () => {
      try {
        setLoading(true);
        const userData = await fetchUserData(userId);
        setUser(userData);
      } catch (err) {
        setError('Failed to load user profile');
      } finally {
        setLoading(false);
      }
    };

    loadUser();
  }, [userId]);

  const handleEditProfile = () => {
    // Handle edit profile
  };

  if (loading) {
    return <div>Loading...</div>;
  }

  if (error || !user) {
    return <div>{error || 'User not found'}</div>;
  }

  return (
    <div className="user-profile">
      <h1>{user.name}</h1>
      <p>{user.email}</p>
      <button onClick={handleEditProfile}>Edit Profile</button>
    </div>
  );
};

export default UserProfile;
```

### 1.4 样式规范

- **优先使用 Tailwind CSS** 进行样式设计
- 避免内联样式，除非是动态样式
- 使用 CSS 变量管理主题颜色
- 组件样式应该模块化，避免全局样式冲突
- 使用语义化的 CSS 类名

```typescript
// 好的样式使用
<div className="flex flex-col items-center justify-center p-4 bg-white rounded-lg shadow-md">
  {/* ... */}
</div>

// 不好的样式使用
<div style={{ display: 'flex', flexDirection: 'column' }}>
  {/* ... */}
</div>
```

## 2. 注释规范

### 2.1 基本规则

- 注释应该清晰、简洁、有意义
- 注释应该解释「为什么」，而不是「是什么」
- 避免过度注释，好的代码应该自解释
- 使用中文编写注释，除非是技术术语或 API 名称

### 2.2 文件头部注释

- 每个文件应该包含文件头部注释，说明文件的用途、作者和创建日期
- 对于公共 API 或重要组件，应该包含更详细的描述

```typescript
/**
 * 用户配置文件组件 - 显示用户的基本信息和配置
 * @file src/components/UserProfile.tsx
 * @description 用于展示和编辑用户配置文件的 React 组件
 * @author Your Name
 * @created 2025-12-13
 * @version 1.0.0
 */
```

### 2.3 函数和方法注释

- 使用 JSDoc 注释格式
- 包含函数的功能、参数、返回值和异常信息
- 对于异步函数，应该明确返回类型和可能的异常

```typescript
/**
 * 获取用户数据
 * @param {string} userId - 用户 ID
 * @returns {Promise<User | null>} 用户数据或 null（如果失败）
 * @throws {Error} 当网络请求失败时抛出错误
 * @description 从 API 获取指定用户的详细信息
 */
const fetchUserData = async (userId: string): Promise<User | null> => {
  // 实现...
};
```

### 2.4 类和接口注释

- 使用 JSDoc 注释格式
- 包含类或接口的用途和核心功能
- 对于接口，应该说明每个属性的含义和用途

```typescript
/**
 * 用户接口定义
 * @interface User
 * @description 定义了用户对象的结构和属性
 */
interface User {
  id: string;           // 用户唯一标识符
  name: string;         // 用户名
  email: string;        // 邮箱地址
  avatar?: string;      // 头像 URL（可选）
  createdAt: Date;      // 创建时间
}
```

### 2.5 复杂逻辑注释

- 对于复杂的算法或业务逻辑，应该添加实现思路注释
- 注释应该解释代码的设计思路和关键步骤
- 避免逐行注释，应该注释代码块的整体逻辑

```typescript
/**
 * 计算斐波那契数列
 * @param {number} n - 数列的长度
 * @returns {number[]} 斐波那契数列数组
 * @description 使用动态规划的方法计算斐波那契数列，时间复杂度 O(n)，空间复杂度 O(1)
 */
const fibonacci = (n: number): number[] => {
  if (n <= 0) return [];
  if (n === 1) return [0];
  if (n === 2) return [0, 1];

  const result: number[] = [0, 1];
  
  // 从第三个元素开始计算，每个元素是前两个元素的和
  for (let i = 2; i < n; i++) {
    result.push(result[i - 1] + result[i - 2]);
  }

  return result;
};
```

### 2.6 关键变量注释

- 对于复杂的变量或常量，应该添加注释说明其含义和使用场景
- 对于魔法数字或字符串，应该添加注释说明其含义

```typescript
// 好的变量注释
const API_TIMEOUT = 30000; // API 请求超时时间（毫秒）
const MAX_RETRY_ATTEMPTS = 3; // 最大重试次数

// 不好的变量注释
const timeout = 30000; // 超时时间
const maxRetries = 3; // 最大重试次数
```

## 3. Git 工作流

### 3.1 分支策略

采用 Git Flow 工作流，主要包含以下分支：

- **main**: 生产分支，包含稳定、可部署的代码
- **develop**: 开发分支，包含最新的开发代码
- **feature/\<feature-name\>**: 特性分支，用于开发新功能
- **fix/\<bug-name\>**: 修复分支，用于修复 bug
- **release/\<version\>**: 发布分支，用于准备发布新版本
- **hotfix/\<bug-name\>**: 热修复分支，用于修复生产环境中的紧急 bug

### 3.2 分支命名规范

- 分支名应该清晰、描述性强
- 使用小写字母和连字符分隔单词
- 特性分支: `feature/add-user-authentication`
- 修复分支: `fix/resolve-login-error`
- 发布分支: `release/v1.0.0`
- 热修复分支: `hotfix/fix-security-vulnerability`

### 3.3 提交规范

#### 3.3.1 提交消息格式

采用 Conventional Commits 规范，提交消息格式：

```
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

#### 3.3.2 提交类型

- **feat**: 新功能
- **fix**: 修复 bug
- **docs**: 文档更新
- **style**: 代码风格调整
- **refactor**: 代码重构
- **perf**: 性能优化
- **test**: 测试相关
- **build**: 构建配置更新
- **ci**: CI/CD 配置更新
- **chore**: 其他杂项更改
- **revert**: 回滚提交

#### 3.3.3 提交示例

```
feat(auth): add user authentication

- Implement login and register functionality
- Add JWT token support
- Update user profile page

Closes #123
```

```
fix(ui): resolve button alignment issue

- Fix button alignment in the header component
- Update CSS flexbox properties

Fixes #456
```

### 3.4 代码审查

- 所有代码变更必须经过代码审查
- 至少需要 1 个审查者批准才能合并
- 审查者应该检查代码质量、逻辑正确性和安全性
- 审查者应该提供具体的反馈和建议
- 作者应该及时响应审查反馈

### 3.5 合并策略

- 使用 Squash and Merge 合并特性分支和修复分支
- 使用 Merge 合并发布分支和热修复分支
- 合并前必须确保所有测试通过
- 合并后应该删除源分支

## 4. 开发流程

### 4.1 开发前准备

1. 从 `main` 分支创建 `develop` 分支（如果不存在）
2. 更新本地代码：`git pull origin develop`
3. 创建特性分支：`git checkout -b feature/<feature-name>`

### 4.2 开发过程

1. 编写代码，遵循代码风格和注释规范
2. 编写单元测试和集成测试
3. 运行测试：`npm test`
4. 运行代码检查：`npm run lint`
5. 运行类型检查：`npm run typecheck`
6. 定期提交代码，遵循提交规范
7. 定期推送到远程分支：`git push origin feature/<feature-name>`

### 4.3 代码审查

1. 创建 Pull Request (PR) 到 `develop` 分支
2. 邀请团队成员进行代码审查
3. 处理审查反馈，更新代码
4. 确保所有测试通过
5. 获得至少 1 个批准

### 4.4 合并代码

1. 合并 PR 到 `develop` 分支
2. 删除特性分支
3. 更新本地 `develop` 分支：`git checkout develop && git pull origin develop`

### 4.5 发布流程

1. 从 `develop` 分支创建发布分支：`git checkout -b release/vx.x.x`
2. 更新版本号和 CHANGELOG
3. 运行所有测试和检查
4. 创建 PR 到 `main` 分支
5. 获得批准后合并到 `main` 分支
6. 在 `main` 分支创建标签：`git tag vx.x.x`
7. 推送标签到远程：`git push origin vx.x.x`
8. 从 `release` 分支合并到 `develop` 分支
9. 删除发布分支

### 4.6 热修复流程

1. 从 `main` 分支创建热修复分支：`git checkout -b hotfix/<bug-name>`
2. 修复 bug
3. 运行测试和检查
4. 更新版本号和 CHANGELOG
5. 创建 PR 到 `main` 分支
6. 获得批准后合并到 `main` 分支
7. 在 `main` 分支创建标签：`git tag vx.x.x`
8. 推送标签到远程：`git push origin vx.x.x`
9. 从 `hotfix` 分支合并到 `develop` 分支
10. 删除热修复分支

## 5. 测试规范

### 5.1 测试类型

#### 5.1.1 单元测试

- 测试单个函数或组件的核心功能
- 使用 Vitest 进行单元测试
- 测试文件与被测试文件放在同一目录下，命名为 `*.test.ts` 或 `*.spec.ts`
- 测试覆盖率要求：核心功能模块达到 80% 以上

#### 5.1.2 集成测试

- 测试组件之间的交互
- 使用 React Testing Library 进行集成测试
- 测试文件放在 `src/__tests__` 目录下
- 测试覆盖率要求：关键功能流程达到 100% 覆盖

#### 5.1.3 E2E 测试

- 测试完整的用户流程
- 使用 Playwright 进行 E2E 测试
- 测试文件放在 `tests` 目录下
- 测试覆盖率要求：主要用户流程达到 100% 覆盖

### 5.2 测试编写规范

- 测试应该清晰、简洁、可维护
- 测试应该覆盖正常情况和异常情况
- 测试应该使用描述性的名称
- 测试应该独立、可重复执行
- 测试应该遵循 Arrange-Act-Assert 模式

```typescript
// 好的测试示例
describe('fetchUserData', () => {
  it('should return user data when given a valid userId', async () => {
    // Arrange
    const userId = '123';
    const mockUser = { id: userId, name: 'Test User', email: 'test@example.com' };
    
    // Act
    const result = await fetchUserData(userId);
    
    // Assert
    expect(result).toEqual(mockUser);
  });

  it('should return null when given an invalid userId', async () => {
    // Arrange
    const invalidUserId = 'invalid-id';
    
    // Act
    const result = await fetchUserData(invalidUserId);
    
    // Assert
    expect(result).toBeNull();
  });
});
```

### 5.3 测试执行

- 开发过程中：`npm test` 或 `npm test -- --watch`
- 提交前：`npm test` 和 `npm run lint`
- CI/CD 流程：自动运行所有测试

## 6. CI/CD 配置

### 6.1 持续集成

- 代码提交时自动运行：
  - 代码检查：`npm run lint`
  - 类型检查：`npm run typecheck`
  - 单元测试：`npm test`
  - 构建检查：`npm run build`

### 6.2 持续部署

- 合并到 `main` 分支时自动部署到生产环境
- 合并到 `develop` 分支时自动部署到测试环境
- 使用 GitHub Actions 或 GitLab CI 进行 CI/CD 配置

### 6.3 部署检查

- 部署前运行所有测试和检查
- 部署后进行健康检查
- 监控部署状态和应用性能

## 7. 代码质量工具

### 7.1 ESLint

- 配置文件：`.eslintrc.json`
- 规则：基于 Airbnb 或 Standard 规则集，根据项目需求调整
- 运行：`npm run lint`

### 7.2 Prettier

- 配置文件：`.prettierrc.json`
- 规则：根据项目需求配置
- 运行：`npm run format` 或编辑器自动格式化

### 7.3 TypeScript

- 配置文件：`tsconfig.json`
- 严格模式：启用 `strict: true`
- 运行类型检查：`npm run typecheck`

### 7.4 其他工具

- **Husky**: Git hooks，用于在提交前运行检查
- **lint-staged**: 仅对暂存的文件运行 lint 和 format
- **Lighthouse**: 性能和可访问性检查
- **Playwright**: E2E 测试

## 8. 文档规范

### 8.1 README.md

- 项目概述
- 技术栈
- 环境搭建步骤
- 开发流程
- 测试说明
- 部署步骤
- 贡献指南
- 许可证信息

### 8.2 API 文档

- 使用 Swagger 或 OpenAPI 规范
- 包含所有 API 端点的详细信息
- 包含请求和响应示例
- 包含错误代码和描述

### 8.3 组件文档

- 使用 Storybook 或其他组件文档工具
- 包含组件的使用示例和属性说明
- 包含组件的不同变体和状态
- 包含组件的 accessibility 信息

### 8.4 架构文档

- 项目架构图
- 数据流说明
- 核心模块说明
- 依赖关系图
- 性能优化策略

## 9. 安全规范

### 9.1 代码安全

- 避免使用 `eval()` 或 `Function()` 构造函数
- 避免使用 `innerHTML`，使用 `textContent` 或 React 元素
- 验证和清理用户输入
- 使用参数化查询防止 SQL 注入
- 避免硬编码敏感信息
- 使用 HTTPS 加密传输

### 9.2 API 安全

- 使用 JWT 或 OAuth 进行认证
- 实现 API 限流
- 使用 HTTPS 加密 API 请求
- 验证 API 请求头和参数
- 实现适当的错误处理，不暴露敏感信息

### 9.3 依赖安全

- 定期更新依赖：`npm update` 或 `npm audit`
- 使用 `npm audit` 检查依赖中的安全漏洞
- 避免使用已知存在安全漏洞的依赖
- 使用锁文件固定依赖版本

## 10. 性能优化

### 10.1 前端性能优化

- 代码分割：使用 `React.lazy` 和 `Suspense`
- 懒加载：使用 `React.lazy` 或 `IntersectionObserver`
- 缓存：使用 `React.memo`、`useMemo` 和 `useCallback`
- 优化图片：使用适当的尺寸和格式，启用延迟加载
- 减少网络请求：合并请求，使用 CDN
- 优化渲染：避免不必要的重新渲染

### 10.2 后端性能优化

- 优化数据库查询：使用索引，避免 N+1 查询
- 实现缓存：使用 Redis 或其他缓存系统
- 优化 API 响应：只返回必要的数据
- 实现异步处理：使用 Web Workers 或异步函数
- 优化代码：减少内存使用，提高执行效率

### 10.3 性能监控

- 使用 Lighthouse 进行性能检查
- 使用 Chrome DevTools 进行性能分析
- 实现前端性能监控：使用 Sentry 或 New Relic
- 实现后端性能监控：使用 Prometheus 或 Grafana

## 11. 可访问性 (a11y) 规范

### 11.1 基本原则

- 遵循 WCAG 2.1 AA 标准
- 确保所有内容可通过键盘访问
- 确保适当的颜色对比度
- 确保所有图像有 alt 文本
- 确保表单元素有标签
- 确保音频和视频有字幕

### 11.2 开发实践

- 使用语义化 HTML 元素
- 使用 ARIA 属性增强可访问性
- 测试键盘导航
- 测试屏幕阅读器兼容性
- 使用颜色对比度工具检查颜色方案
- 实现适当的焦点管理

## 12. 团队协作规范

### 12.1 沟通渠道

- **Slack/Discord**: 日常沟通和讨论
- **GitHub/GitLab**: 代码审查和 issue 管理
- **Jira/Trello**: 任务管理和进度跟踪
- **Zoom/Meet**: 会议和视频通话

### 12.2 会议规范

- 保持会议简洁、高效
- 提前准备会议议程
- 准时开始和结束
- 记录会议纪要和行动项
- 避免不必要的会议

### 12.3 代码审查规范

- 及时审查代码，不超过 24 小时
- 提供具体、建设性的反馈
- 尊重他人的工作
- 关注代码质量、安全性和可维护性
- 避免过度挑剔或吹毛求疵

### 12.4 文档协作

- 保持文档更新及时
- 使用版本控制管理文档
- 遵循一致的文档格式
- 定期审查和更新文档

## 13. 总结

本开发规范旨在确保团队成员遵循一致的开发实践，提高代码质量、可维护性和团队协作效率。所有团队成员应该熟悉并遵守这些规范，不断改进和完善开发流程。

规范是活的文档，应该根据项目需求和团队反馈定期更新和调整。

---

**最后更新**: 2025-12-13
**版本**: 1.0.0