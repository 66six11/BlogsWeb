# 魔法乐谱格式说明 (Sheet Music Format Guide)

编辑器支持两种乐谱格式：**ABC记谱法** (推荐) 和 **旧版格式**。

---

## ABC记谱法 (ABC Notation)

ABC记谱法是一种国际通用的文本音乐记谱格式。编辑器自动识别ABC格式文件。

### 基本结构

```abc
X:1                    % 曲目编号
T:曲目标题             % 标题
C:作曲家               % 作曲者
M:4/4                  % 拍号
L:1/8                  % 默认音符时值
Q:1/4=120              % 速度 (每分钟120个四分音符)
K:C                    % 调号 (K:之后开始音乐内容)

% 音乐内容
C D E F | G A B c |
```

### 音符表示

| ABC符号 | 音符 | 八度 |
|---------|------|------|
| C D E F G A B | Do Re Mi Fa Sol La Si | 第4八度 (中央) |
| c d e f g a b | do re mi fa sol la si | 第5八度 (高) |
| C, D, E, | Do, Re, Mi, | 第3八度 (低) |
| c' d' e' | do' re' mi' | 第6八度 (更高) |

### 升降号

| 符号 | 含义 |
|------|------|
| ^C | 升C (C#) |
| _B | 降B (Bb) |
| =C | 还原C |

### 时值

默认时值由 `L:` 字段指定 (如 `L:1/8` 表示八分音符)。

| 写法 | 时值 |
|------|------|
| C | 默认时值 |
| C2 | 2倍默认时值 |
| C4 | 4倍默认时值 |
| C/2 | 1/2默认时值 |
| C/4 | 1/4默认时值 |
| C3/2 | 1.5倍默认时值 |

### 和弦

用方括号包围同时演奏的音符：

```abc
[CEG]   % C大三和弦
[DFA]   % D小三和弦
[GBd]   % G大三和弦 (d是高八度)
```

### 休止符

| 符号 | 含义 |
|------|------|
| z | 休止 (默认时值) |
| z2 | 2倍休止 |
| Z | 整小节休止 |

### 小节线

```abc
| % 小节线
|] % 结束线
|: % 反复开始
:| % 反复结束
```

### 多声部

使用 `V:` 定义不同声部：

```abc
V:1 name="高音"
c d e f |

V:2 name="低音"
C, D, E, F, |
```

### 完整示例：小星星

```abc
X:1
T:Twinkle Twinkle Little Star
M:4/4
L:1/4
Q:1/4=100
K:C

C C G G | A A G2 | F F E E | D D C2 |
G G F F | E E D2 | G G F F | E E D2 |
C C G G | A A G2 | F F E E | D D C2 |
```

---

## 旧版格式 (Legacy Format)

兼容之前版本的简化格式。

### 基本格式

每行一个音符或和弦：
```
音符名 八度 时值
```

### 元数据

```
#@ title: 曲目名称
#@ bpm: 120
#@ key: C Major
#@ time: 4/4
```

### 音符参数

**音符名**: C, C#, D, D#, E, F, F#, G, G#, A, A#, B (支持 Db, Eb 等等音)

**八度**: 3, 4, 5

**时值** (十六分音符为单位): 1=十六分, 2=八分, 4=四分, 8=二分, 16=全

### 和弦

用 `+` 连接同时演奏的音符：
```
C 4 + E 4 + G 4 4
```

### 多轨道

```
[Bass]
C 3 4

[Melody:0]
E 5 4
```

---

## 文件存放

将乐谱文件放入 `/public/scores/` 目录，在 `config.ts` 中添加：

```typescript
scores: {
  folder: "/scores",
  files: ['my-song.abc', 'other-song.txt']
}
```

**推荐使用 `.abc` 扩展名** 表示ABC记谱法文件。
